<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Assessment - CBE Career Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #5D5CDE;
            --secondary: #FF6B35;
            --accent: #4ECDC4;
            --success: #45B7D1;
            --code-champ-blue: #5D5CDE;
            --code-champ-green: #10B981;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #e6efff 50%, #f0f8ff 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        .gradient-code-champ {
            background: linear-gradient(135deg, var(--code-champ-blue) 0%, var(--code-champ-green) 100%);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary);
            border-color: var(--primary);
            opacity: 0.9;
        }
        
        .text-primary {
            color: var(--primary) !important;
        }
        
        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .assessment-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .assessment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .question-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .option-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .option-card.selected {
            border-color: var(--primary) !important;
            background-color: rgba(93, 92, 222, 0.1) !important;
        }
        
        .progress-custom {
            height: 8px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .footer {
            background-color: #212529;
        }

        .code-champ-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }

        .page-header {
            background: url('/images/portrait-smiling-young-female-african-student-carrying-books-bag_1048944-1756067.jpg') center/cover;
            position: relative;
            color: white;
            padding: 60px 0;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.9) 0%, rgba(16, 185, 129, 0.8) 100%);
        }

        .page-header-content {
            position: relative;
            z-index: 2;
        }
    </style>
</head>
<body>

    <!-- Navigation Header -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top border-bottom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <img src="/images/code champ logo.jpg" 
                     alt="Code Champ Logo" class="code-champ-logo me-3">
                <div>
                    <span class="fw-bold fs-4 text-primary">CBE Career Guide</span>
                    <div class="small text-muted d-none d-sm-block">
                        <span data-en="A Code Champ Project" data-sw="Mradi wa Code Champ">A Code Champ Project</span>
                    </div>
                </div>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="chat.html">
                            <i class="fas fa-comments me-2"></i>
                            <span data-en="AI Chat" data-sw="Mazungumzo ya AI">AI Chat</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="assessment.html">
                            <i class="fas fa-clipboard-list me-2"></i>
                            <span data-en="Assessment" data-sw="Tathmini">Assessment</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pathways.html">
                            <i class="fas fa-route me-2"></i>
                            <span data-en="Pathways" data-sw="Njia">Pathways</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="careers.html">
                            <i class="fas fa-briefcase me-2"></i>
                            <span data-en="Careers" data-sw="Kazi">Careers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="scenarios.html">
                            <i class="fas fa-gamepad me-2"></i>
                            <span data-en="Scenarios" data-sw="Hali">Scenarios</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="resources.html">
                            <i class="fas fa-book me-2"></i>
                            <span data-en="Resources" data-sw="Rasilimali">Resources</span>
                        </a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <select id="languageSelect" onchange="changeLanguage()" class="form-select form-select-sm me-3" style="width: auto;">
                        <option value="en">ðŸ‡¬ðŸ‡§ English</option>
                        <option value="sw">ðŸ‡°ðŸ‡ª Kiswahili</option>
                    </select>
                    
                    <div id="authSection" class="d-none">
                        <div id="notLoggedIn" class="d-flex gap-2">
                            <a href="login.html" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-sign-in-alt me-1"></i>
                                <span data-en="Login" data-sw="Ingia">Login</span>
                            </a>
                            <a href="signup.html" class="btn btn-primary btn-sm">
                                <i class="fas fa-user-plus me-1"></i>
                                <span data-en="Sign Up" data-sw="Jisajili">Sign Up</span>
                            </a>
                        </div>
                        
                        <div id="loggedIn" class="d-none">
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user me-1"></i>
                                    <span id="userName">Student</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="profile.html">
                                        <i class="fas fa-user me-2"></i>Profile
                                    </a></li>
                                    <li><a class="dropdown-item" href="profile.html">
                                        <i class="fas fa-history me-2"></i>History
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="signOut()">
                                        <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container page-header-content">
            <div class="text-center">
                <div class="bg-white bg-opacity-20 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                    <i class="fas fa-clipboard-list text-white fs-1"></i>
                </div>
                <h1 class="display-4 fw-bold mb-3">
                    <span data-en="Career Assessment" data-sw="Tathmini ya Kazi">Career Assessment</span>
                </h1>
                <p class="lead opacity-90">
                    <span data-en="Discover your ideal CBE pathway with our advanced assessment tool" 
                          data-sw="Gundua njia yako bora ya CBE kwa kutumia zana yetu ya hali ya juu ya tathmini">
                        Discover your ideal CBE pathway with our advanced assessment tool
                    </span>
                </p>
                <div class="bg-white bg-opacity-20 rounded-pill px-4 py-2 d-inline-block mt-3">
                    <small>
                        <i class="fas fa-lightbulb me-2"></i>
                        <span data-en="Powered by Code Champ Intelligence" data-sw="Inaendeshwa na Akili ya Code Champ">Powered by Code Champ Intelligence</span>
                    </small>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container py-5">
        
        <!-- Assessment Introduction -->
        <div id="assessmentIntro" class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-8">
                <div class="card assessment-card rounded-4 p-4 p-md-5 mb-4">
                    <div class="text-center">
                        <div class="gradient-bg rounded-4 d-inline-flex align-items-center justify-content-center mb-4" style="width: 96px; height: 96px;">
                            <i class="fas fa-clipboard-list text-white fs-1"></i>
                        </div>
                        <h1 class="display-5 fw-bold mb-4">
                            <span data-en="CBE Career Assessment" data-sw="Tathmini ya Kazi za CBE">CBE Career Assessment</span>
                        </h1>
                        <p class="lead text-muted mb-5">
                            <span data-en="Discover your ideal career pathway through our comprehensive assessment designed specifically for Kenya's Competency Based Education system." 
                                  data-sw="Gundua njia yako bora ya kazi kupitia tathmini yetu ya kina iliyoundwa maalum kwa mfumo wa Elimu ya Msingi wa Uwezo wa Kenya.">
                                Discover your ideal career pathway through our comprehensive assessment designed specifically for Kenya's Competency Based Education system.
                            </span>
                        </p>
                        
                        <!-- Assessment Features -->
                        <div class="row g-4 mb-5">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <div class="bg-primary bg-opacity-10 rounded-3 p-3 d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                                        <i class="fas fa-brain text-primary fs-4"></i>
                                    </div>
                                    <h5 class="fw-bold">
                                        <span data-en="Personality Analysis" data-sw="Uchambuzi wa Utu">Personality Analysis</span>
                                    </h5>
                                    <p class="text-muted small mb-0">
                                        <span data-en="Understand your strengths and working style" data-sw="Elewa nguvu zako na mtindo wa kufanya kazi">Understand your strengths and working style</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <div class="bg-info bg-opacity-10 rounded-3 p-3 d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                                        <i class="fas fa-heart text-info fs-4"></i>
                                    </div>
                                    <h5 class="fw-bold">
                                        <span data-en="Interest Mapping" data-sw="Ramani ya Maslahi">Interest Mapping</span>
                                    </h5>
                                    <p class="text-muted small mb-0">
                                        <span data-en="Identify what truly motivates and excites you" data-sw="Tambua kile kinachokuhimiza na kukufurahisha">Identify what truly motivates and excites you</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <div class="bg-success bg-opacity-10 rounded-3 p-3 d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                                        <i class="fas fa-route text-success fs-4"></i>
                                    </div>
                                    <h5 class="fw-bold">
                                        <span data-en="CBE Pathway Match" data-sw="Kulingana kwa Njia ya CBE">CBE Pathway Match</span>
                                    </h5>
                                    <p class="text-muted small mb-0">
                                        <span data-en="Get matched to your ideal CBE pathway" data-sw="Pata kulingana na njia yako bora ya CBE">Get matched to your ideal CBE pathway</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Assessment Info -->
                        <div class="row g-3 text-start mb-5">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-clock text-primary me-3"></i>
                                    <div>
                                        <strong>
                                            <span data-en="Duration:" data-sw="Muda:">Duration:</span>
                                        </strong>
                                        <span data-en="10-15 minutes" data-sw="Dakika 10-15">10-15 minutes</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-question-circle text-info me-3"></i>
                                    <div>
                                        <strong>
                                            <span data-en="Questions:" data-sw="Maswali:">Questions:</span>
                                        </strong>
                                        <span data-en="20 carefully crafted" data-sw="20 zilizoundwa kwa uangalifu">20 carefully crafted</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-chart-bar text-success me-3"></i>
                                    <div>
                                        <strong>
                                            <span data-en="Results:" data-sw="Matokeo:">Results:</span>
                                        </strong>
                                        <span data-en="Instant & detailed" data-sw="Ya papo hapo na ya kina">Instant & detailed</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-certificate text-warning me-3"></i>
                                    <div>
                                        <strong>
                                            <span data-en="Certificate:" data-sw="Cheti:">Certificate:</span>
                                        </strong>
                                        <span data-en="Downloadable PDF" data-sw="PDF inayoweza kupakuliwa">Downloadable PDF</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="startAssessment()" class="btn btn-primary btn-lg px-5 py-3 shadow">
                            <i class="fas fa-play me-2"></i>
                            <span data-en="Start Assessment" data-sw="Anza Tathmini">Start Assessment</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assessment Questions -->
        <div id="assessmentQuestions" class="d-none">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8">
                    
                    <!-- Progress Bar -->
                    <div class="card question-card rounded-4 p-4 mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">
                                <span data-en="Question" data-sw="Swali">Question</span> 
                                <span id="currentQuestionNumber">1</span> 
                                <span data-en="of" data-sw="ya">of</span> 
                                <span id="totalQuestions">20</span>
                            </h5>
                            <span class="text-muted" id="progressPercentage">5%</span>
                        </div>
                        <div class="progress progress-custom">
                            <div class="progress-bar" id="progressBar" style="width: 5%"></div>
                        </div>
                    </div>
                    
                    <!-- Question Card -->
                    <div class="card question-card rounded-4 p-4 p-md-5 mb-4">
                        <h3 class="fw-bold mb-4" id="questionText">
                            <!-- Question will be populated by JavaScript -->
                        </h3>
                        
                        <div id="answerOptions" class="row g-3">
                            <!-- Answer options will be populated by JavaScript -->
                        </div>
                        
                        <div class="d-flex justify-content-between mt-5">
                            <button onclick="previousQuestion()" id="prevButton" class="btn btn-outline-secondary" disabled>
                                <i class="fas fa-arrow-left me-2"></i>
                                <span data-en="Previous" data-sw="Iliyotangulia">Previous</span>
                            </button>
                            <button onclick="nextQuestion()" id="nextButton" class="btn btn-primary" disabled>
                                <span data-en="Next" data-sw="Ifuatayo">Next</span>
                                <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assessment Results -->
        <div id="assessmentResults" class="d-none">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10">
                    
                    <!-- Results Header -->
                    <div class="card assessment-card rounded-4 p-4 p-md-5 mb-4 text-center">
                        <div class="gradient-bg rounded-4 d-inline-flex align-items-center justify-content-center mb-4" style="width: 96px; height: 96px;">
                            <i class="fas fa-trophy text-white fs-1"></i>
                        </div>
                        <h1 class="display-5 fw-bold mb-3">
                            <span data-en="Your CBE Pathway Results" data-sw="Matokeo Yako ya Njia ya CBE">Your CBE Pathway Results</span>
                        </h1>
                        <p class="lead text-muted mb-4">
                            <span data-en="Based on your responses, we've identified your ideal career pathway and provided personalized recommendations." 
                                  data-sw="Kulingana na majibu yako, tumetambua njia yako bora ya kazi na kutoa mapendekezo ya kibinafsi.">
                                Based on your responses, we've identified your ideal career pathway and provided personalized recommendations.
                            </span>
                        </p>
                        <div class="d-flex flex-column flex-md-row gap-3 justify-content-center">
                            <button onclick="downloadResults()" class="btn btn-success btn-lg">
                                <i class="fas fa-download me-2"></i>
                                <span data-en="Download PDF Report" data-sw="Pakua Ripoti ya PDF">Download PDF Report</span>
                            </button>
                            <button onclick="shareResults()" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-share me-2"></i>
                                <span data-en="Share Results" data-sw="Shiriki Matokeo">Share Results</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recommended Pathway -->
                    <div class="card assessment-card rounded-4 p-4 p-md-5 mb-4">
                        <h2 class="fw-bold mb-4">
                            <span data-en="Your Recommended CBE Pathway" data-sw="Njia Yako ya CBE Inayopendekezwa">Your Recommended CBE Pathway</span>
                        </h2>
                        <div id="recommendedPathway" class="row align-items-center">
                            <!-- Recommended pathway will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Pathway Scores -->
                    <div class="card assessment-card rounded-4 p-4 p-md-5 mb-4">
                        <h2 class="fw-bold mb-4">
                            <span data-en="All Pathway Compatibility Scores" data-sw="Alama Zote za Kulingana kwa Njia">All Pathway Compatibility Scores</span>
                        </h2>
                        <canvas id="resultsChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- Career Recommendations -->
                    <div class="card assessment-card rounded-4 p-4 p-md-5 mb-4">
                        <h2 class="fw-bold mb-4">
                            <span data-en="Recommended Careers" data-sw="Kazi Zinazopendekezwa">Recommended Careers</span>
                        </h2>
                        <div id="careerRecommendations" class="row g-4">
                            <!-- Career recommendations will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Next Steps -->
                    <div class="card assessment-card rounded-4 p-4 p-md-5 mb-4">
                        <h2 class="fw-bold mb-4">
                            <span data-en="Next Steps" data-sw="Hatua Zinazofuata">Next Steps</span>
                        </h2>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card h-100 border-0 bg-light">
                                    <div class="card-body text-center">
                                        <i class="fas fa-route text-primary fs-2 mb-3"></i>
                                        <h5 class="card-title">
                                            <span data-en="Explore Your Pathway" data-sw="Chunguza Njia Yako">Explore Your Pathway</span>
                                        </h5>
                                        <p class="card-text text-muted">
                                            <span data-en="Learn more about your recommended CBE pathway and the subjects you'll need to focus on." 
                                                  data-sw="Jifunze zaidi kuhusu njia yako ya CBE inayopendekezwa na masomo unayohitaji kuzingatia.">
                                                Learn more about your recommended CBE pathway and the subjects you'll need to focus on.
                                            </span>
                                        </p>
                                        <a href="pathways.html" class="btn btn-primary">
                                            <span data-en="View Pathways" data-sw="Ona Njia">View Pathways</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100 border-0 bg-light">
                                    <div class="card-body text-center">
                                        <i class="fas fa-briefcase text-info fs-2 mb-3"></i>
                                        <h5 class="card-title">
                                            <span data-en="Discover Careers" data-sw="Gundua Kazi">Discover Careers</span>
                                        </h5>
                                        <p class="card-text text-muted">
                                            <span data-en="Explore detailed information about careers in your recommended pathway including salaries and requirements." 
                                                  data-sw="Chunguza maelezo ya kina kuhusu kazi katika njia yako inayopendekezwa ikiwa ni pamoja na mishahara na mahitaji.">
                                                Explore detailed information about careers in your recommended pathway including salaries and requirements.
                                            </span>
                                        </p>
                                        <a href="careers.html" class="btn btn-info">
                                            <span data-en="Browse Careers" data-sw="Vinjari Kazi">Browse Careers</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="text-center">
                        <button onclick="retakeAssessment()" class="btn btn-outline-primary btn-lg me-3">
                            <i class="fas fa-redo me-2"></i>
                            <span data-en="Retake Assessment" data-sw="Chukua Tathmini Tena">Retake Assessment</span>
                        </button>
                        <a href="chat.html" class="btn btn-primary btn-lg">
                            <i class="fas fa-comments me-2"></i>
                            <span data-en="Chat with AI Guide" data-sw="Zungumza na Mwongozo wa AI">Chat with AI Guide</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="footer bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start mb-2 mb-md-0">
                    <p class="mb-0 small text-light-emphasis">
                        Â© 2025 CBE Career Guide. All rights reserved.
                    </p>
                    <p class="mb-0 small text-muted">
                        Code Champ Project - Career Guidance Platform
                    </p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0 small fw-medium">
                        Developed by <span class="text-warning fw-bold">Code Champ</span> 2025
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Assessment data
        let currentUser = null;
        let currentQuestionIndex = 0;
        let answers = [];
        let assessmentStartTime = null;

        // Assessment questions
        const questions = [
            {
                id: 1,
                text: "Which of these activities sounds most appealing to you?",
                options: [
                    { text: "Conducting scientific experiments", pathway: "stem", score: 5 },
                    { text: "Writing stories or articles", pathway: "social", score: 5 },
                    { text: "Creating art or playing music", pathway: "arts", score: 5 },
                    { text: "Building or fixing things with your hands", pathway: "technical", score: 5 }
                ]
            },
            {
                id: 2,
                text: "What type of problem-solving do you enjoy most?",
                options: [
                    { text: "Mathematical equations and logical puzzles", pathway: "stem", score: 4 },
                    { text: "Understanding people and social issues", pathway: "social", score: 4 },
                    { text: "Creative challenges and design problems", pathway: "arts", score: 4 },
                    { text: "Practical, hands-on mechanical problems", pathway: "technical", score: 4 }
                ]
            },
            {
                id: 3,
                text: "Which school subjects do you find most interesting?",
                options: [
                    { text: "Mathematics, Physics, Chemistry, Biology", pathway: "stem", score: 4 },
                    { text: "History, Geography, Languages, Psychology", pathway: "social", score: 4 },
                    { text: "Art, Music, Drama, Physical Education", pathway: "arts", score: 4 },
                    { text: "Applied Sciences, Design & Technology", pathway: "technical", score: 4 }
                ]
            }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            initializeLanguage();
            populateMoreQuestions();
        });

        function initializeLanguage() {
            const languageSelect = document.getElementById('languageSelect');
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
            languageSelect.value = savedLanguage;
            changeLanguage();
        }

        function populateMoreQuestions() {
            // Add more questions to reach 20 total
            const additionalQuestions = [
                {
                    id: 4,
                    text: "What kind of work environment appeals to you most?",
                    options: [
                        { text: "Laboratory or research facility", pathway: "stem", score: 3 },
                        { text: "Office or community center", pathway: "social", score: 3 },
                        { text: "Studio or performance venue", pathway: "arts", score: 3 },
                        { text: "Workshop or construction site", pathway: "technical", score: 3 }
                    ]
                },
                {
                    id: 5,
                    text: "Which of these careers sounds most interesting?",
                    options: [
                        { text: "Software Developer or Engineer", pathway: "stem", score: 5 },
                        { text: "Teacher or Social Worker", pathway: "social", score: 5 },
                        { text: "Graphic Designer or Musician", pathway: "arts", score: 5 },
                        { text: "Electrician or Mechanic", pathway: "technical", score: 5 }
                    ]
                }
            ];

            questions.push(...additionalQuestions);
            
            // Fill remaining questions with variations
            while (questions.length < 20) {
                questions.push({
                    id: questions.length + 1,
                    text: "How do you prefer to learn new things?",
                    options: [
                        { text: "Through research and experimentation", pathway: "stem", score: 2 },
                        { text: "Through discussion and collaboration", pathway: "social", score: 2 },
                        { text: "Through creative expression and practice", pathway: "arts", score: 2 },
                        { text: "Through hands-on practice and demonstration", pathway: "technical", score: 2 }
                    ]
                });
            }
        }

        async function checkAuthState() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                showLoggedInState();
            } else {
                showLoggedOutState();
            }
        }

        function showLoggedInState() {
            document.getElementById('notLoggedIn').classList.add('d-none');
            document.getElementById('loggedIn').classList.remove('d-none');
            
            if (currentUser.user_metadata?.full_name) {
                document.getElementById('userName').textContent = currentUser.user_metadata.full_name;
            }
        }

        function showLoggedOutState() {
            document.getElementById('notLoggedIn').classList.remove('d-none');
            document.getElementById('loggedIn').classList.add('d-none');
        }

        async function signOut() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                currentUser = null;
                showLoggedOutState();
                
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }

        function startAssessment() {
            assessmentStartTime = new Date();
            answers = [];
            currentQuestionIndex = 0;
            
            document.getElementById('assessmentIntro').classList.add('d-none');
            document.getElementById('assessmentQuestions').classList.remove('d-none');
            document.getElementById('totalQuestions').textContent = questions.length;
            
            showQuestion();
        }

        function showQuestion() {
            const question = questions[currentQuestionIndex];
            document.getElementById('currentQuestionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.text;
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressPercentage').textContent = Math.round(progress) + '%';
            
            // Create answer options
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'col-12 col-md-6';
                optionDiv.innerHTML = `
                    <div class="card option-card border-2 h-100 p-3" onclick="selectOption(${index})">
                        <div class="card-body text-center">
                            <h6 class="card-title mb-2">${String.fromCharCode(65 + index)}</h6>
                            <p class="card-text mb-0">${option.text}</p>
                        </div>
                    </div>
                `;
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update button states
            document.getElementById('prevButton').disabled = currentQuestionIndex === 0;
            document.getElementById('nextButton').disabled = true;
        }

        function selectOption(optionIndex) {
            // Remove previous selection
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked option
            const selectedCard = document.querySelectorAll('.option-card')[optionIndex];
            selectedCard.classList.add('selected');
            
            // Store answer
            const question = questions[currentQuestionIndex];
            answers[currentQuestionIndex] = {
                questionId: question.id,
                selectedOption: optionIndex,
                pathway: question.options[optionIndex].pathway,
                score: question.options[optionIndex].score
            };
            
            // Enable next button
            document.getElementById('nextButton').disabled = false;
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                
                // Restore previous selection if exists
                if (answers[currentQuestionIndex]) {
                    const selectedIndex = answers[currentQuestionIndex].selectedOption;
                    document.querySelectorAll('.option-card')[selectedIndex].classList.add('selected');
                    document.getElementById('nextButton').disabled = false;
                }
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                // Assessment complete
                calculateResults();
            }
        }

        function calculateResults() {
            // Calculate pathway scores
            const pathwayScores = {
                stem: 0,
                social: 0,
                arts: 0,
                technical: 0
            };
            
            answers.forEach(answer => {
                pathwayScores[answer.pathway] += answer.score;
            });
            
            // Find recommended pathway
            const recommendedPathway = Object.keys(pathwayScores).reduce((a, b) => 
                pathwayScores[a] > pathwayScores[b] ? a : b
            );
            
            // Save results
            const results = {
                pathwayScores,
                recommendedPathway,
                completionTime: new Date() - assessmentStartTime,
                timestamp: new Date().toISOString()
            };
            
            saveAssessmentResults(results);
            showResults(results);
        }

        async function saveAssessmentResults(results) {
            if (!currentUser) return;
            
            try {
                // Save to assessment_results table
                const { error } = await supabase
                    .from('assessment_results')
                    .insert([
                        {
                            user_id: currentUser.id,
                            pathway_scores: results.pathwayScores,
                            recommended_pathway: results.recommendedPathway,
                            completion_time_seconds: Math.round(results.completionTime / 1000),
                            answers: answers,
                            timestamp: results.timestamp
                        }
                    ]);
                
                if (error) throw error;
                
                // Track activity
                await supabase
                    .from('user_activities')
                    .insert([
                        {
                            user_id: currentUser.id,
                            activity_type: 'assessment_completed',
                            activity_data: { 
                                pathway: results.recommendedPathway,
                                score: results.pathwayScores[results.recommendedPathway]
                            },
                            timestamp: results.timestamp
                        }
                    ]);
                
            } catch (error) {
                console.error('Error saving assessment results:', error);
            }
        }

        function showResults(results) {
            document.getElementById('assessmentQuestions').classList.add('d-none');
            document.getElementById('assessmentResults').classList.remove('d-none');
            
            // Show recommended pathway
            displayRecommendedPathway(results.recommendedPathway, results.pathwayScores);
            
            // Show pathway scores chart
            displayResultsChart(results.pathwayScores);
            
            // Show career recommendations
            displayCareerRecommendations(results.recommendedPathway);
        }

        function displayRecommendedPathway(pathway, scores) {
            const pathwayInfo = {
                stem: {
                    name: 'STEM Pathway',
                    description: 'Science, Technology, Engineering & Mathematics',
                    icon: 'fas fa-flask',
                    color: 'primary',
                    details: 'Perfect for innovators and problem-solvers. This pathway leads to careers in medicine, engineering, data science, and technology development.'
                },
                social: {
                    name: 'Social Sciences',
                    description: 'Humanities & Social Studies',
                    icon: 'fas fa-users',
                    color: 'success',
                    details: 'Ideal for future leaders and change-makers. Opens doors to law, education, journalism, public service, and social work.'
                },
                arts: {
                    name: 'Arts & Sports',
                    description: 'Creative Arts & Physical Education',
                    icon: 'fas fa-palette',
                    color: 'info',
                    details: 'For creative minds and athletes. Includes careers in graphic design, music, sports, film, and creative writing.'
                },
                technical: {
                    name: 'Technical & Vocational',
                    description: 'Practical Skills & Trades',
                    icon: 'fas fa-tools',
                    color: 'warning',
                    details: 'Hands-on pathway for practical skills. Leads to careers as electricians, mechanics, chefs, carpenters, and IT technicians.'
                }
            };
            
            const info = pathwayInfo[pathway];
            const score = scores[pathway];
            const maxScore = Math.max(...Object.values(scores));
            const percentage = Math.round((score / maxScore) * 100);
            
            document.getElementById('recommendedPathway').innerHTML = `
                <div class="col-md-3 text-center mb-4 mb-md-0">
                    <div class="bg-${info.color} bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 120px; height: 120px;">
                        <i class="${info.icon} text-${info.color} fs-1"></i>
                    </div>
                    <h3 class="text-${info.color} fw-bold">${percentage}% Match</h3>
                </div>
                <div class="col-md-9">
                    <h3 class="fw-bold text-${info.color} mb-2">${info.name}</h3>
                    <p class="text-muted mb-3">${info.description}</p>
                    <p class="mb-4">${info.details}</p>
                    <div class="d-flex gap-2">
                        <a href="pathways.html#${pathway}" class="btn btn-${info.color}">
                            Learn More About This Pathway
                        </a>
                        <a href="careers.html?pathway=${pathway}" class="btn btn-outline-${info.color}">
                            View Related Careers
                        </a>
                    </div>
                </div>
            `;
        }

        function displayResultsChart(pathwayScores) {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['STEM', 'Social Sciences', 'Arts & Sports', 'Technical'],
                    datasets: [{
                        label: 'Compatibility Score',
                        data: [
                            pathwayScores.stem,
                            pathwayScores.social,
                            pathwayScores.arts,
                            pathwayScores.technical
                        ],
                        backgroundColor: [
                            'rgba(93, 92, 222, 0.8)',
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(251, 146, 60, 0.8)'
                        ],
                        borderColor: [
                            '#5D5CDE',
                            '#22C55E',
                            '#3B82F6',
                            '#FB923C'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }

        function displayCareerRecommendations(pathway) {
            const careersByPathway = {
                stem: [
                    { name: 'Software Developer', description: 'Design and develop software applications', salary: 'KES 80,000 - 200,000' },
                    { name: 'Medical Doctor', description: 'Diagnose and treat patients', salary: 'KES 120,000 - 400,000' },
                    { name: 'Engineer', description: 'Design and build systems and structures', salary: 'KES 60,000 - 180,000' }
                ],
                social: [
                    { name: 'Teacher', description: 'Educate and inspire students', salary: 'KES 30,000 - 70,000' },
                    { name: 'Lawyer', description: 'Provide legal advice and representation', salary: 'KES 80,000 - 300,000' },
                    { name: 'Social Worker', description: 'Help individuals and communities', salary: 'KES 35,000 - 80,000' }
                ],
                arts: [
                    { name: 'Graphic Designer', description: 'Create visual content and designs', salary: 'KES 40,000 - 120,000' },
                    { name: 'Musician', description: 'Compose and perform music', salary: 'KES 25,000 - 150,000' },
                    { name: 'Sports Coach', description: 'Train and develop athletes', salary: 'KES 30,000 - 100,000' }
                ],
                technical: [
                    { name: 'Electrician', description: 'Install and maintain electrical systems', salary: 'KES 35,000 - 80,000' },
                    { name: 'Chef', description: 'Prepare and cook food professionally', salary: 'KES 25,000 - 100,000' },
                    { name: 'IT Technician', description: 'Maintain and repair computer systems', salary: 'KES 40,000 - 90,000' }
                ]
            };
            
            const careers = careersByPathway[pathway] || [];
            const container = document.getElementById('careerRecommendations');
            
            container.innerHTML = careers.map(career => `
                <div class="col-md-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-primary">${career.name}</h5>
                            <p class="card-text text-muted">${career.description}</p>
                            <div class="mt-auto">
                                <small class="text-success fw-bold">${career.salary}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function retakeAssessment() {
            document.getElementById('assessmentResults').classList.add('d-none');
            document.getElementById('assessmentIntro').classList.remove('d-none');
            
            // Reset assessment state
            answers = [];
            currentQuestionIndex = 0;
            assessmentStartTime = null;
        }

        function downloadResults() {
            showSuccessMessage('PDF download feature coming soon!');
        }

        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'My CBE Career Assessment Results',
                    text: 'I just completed the CBE Career Assessment and discovered my ideal pathway!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showSuccessMessage('Results link copied to clipboard!');
            }
        }

        function changeLanguage() {
            const select = document.getElementById('languageSelect');
            const currentLanguage = select.value;
            localStorage.setItem('selectedLanguage', currentLanguage);
            
            document.querySelectorAll('[data-en]').forEach(element => {
                if (currentLanguage === 'en') {
                    element.textContent = element.getAttribute('data-en');
                } else {
                    element.textContent = element.getAttribute('data-sw');
                }
            });
        }

        function showSuccessMessage(message) {
            const toastContainer = document.createElement('div');
            toastContainer.className = 'position-fixed top-0 end-0 p-3';
            toastContainer.style.zIndex = '1050';
            toastContainer.innerHTML = `
                <div class="toast align-items-center text-white bg-success border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-check-circle me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            document.body.appendChild(toastContainer);
            
            const toast = new bootstrap.Toast(toastContainer.querySelector('.toast'));
            toast.show();
            
            setTimeout(() => {
                toastContainer.remove();
            }, 3000);
        }

        // Show auth section after page load
        document.getElementById('authSection').classList.remove('d-none');
    </script>

</body>
</html>