<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - CBE Career Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #5D5CDE;
            --secondary: #FF6B35;
            --accent: #4ECDC4;
            --success: #45B7D1;
            --code-champ-blue: #5D5CDE;
            --code-champ-green: #10B981;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #e6efff 50%, #f0f8ff 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        .gradient-code-champ {
            background: linear-gradient(135deg, var(--code-champ-blue) 0%, var(--code-champ-green) 100%);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary);
            border-color: var(--primary);
            opacity: 0.9;
        }
        
        .text-primary {
            color: var(--primary) !important;
        }
        
        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .profile-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .profile-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .profile-header {
            position: relative;
            overflow: hidden;
        }
        
        .pathway-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .pathway-option:hover {
            transform: scale(1.02);
        }
        
        .pathway-option.selected {
            border-color: var(--primary) !important;
            background-color: rgba(93, 92, 222, 0.1) !important;
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .footer {
            background-color: #212529;
        }

        .code-champ-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }
    </style>
</head>
<body>

    <!-- Navigation Header -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top border-bottom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <img src="/images/code champ logo.jpg" 
                     alt="Code Champ Logo" class="code-champ-logo me-3">
                <div>
                    <span class="fw-bold fs-4 text-primary">CBE Career Guide</span>
                    <div class="small text-muted d-none d-sm-block">
                        <span data-en="A Code Champ Project" data-sw="Mradi wa Code Champ">A Code Champ Project</span>
                    </div>
                </div>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="chat.html">
                            <i class="fas fa-comments me-2"></i>
                            <span data-en="AI Chat" data-sw="Mazungumzo ya AI">AI Chat</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="assessment.html">
                            <i class="fas fa-clipboard-list me-2"></i>
                            <span data-en="Assessment" data-sw="Tathmini">Assessment</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pathways.html">
                            <i class="fas fa-route me-2"></i>
                            <span data-en="Pathways" data-sw="Njia">Pathways</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="careers.html">
                            <i class="fas fa-briefcase me-2"></i>
                            <span data-en="Careers" data-sw="Kazi">Careers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="scenarios.html">
                            <i class="fas fa-gamepad me-2"></i>
                            <span data-en="Scenarios" data-sw="Hali">Scenarios</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="resources.html">
                            <i class="fas fa-book me-2"></i>
                            <span data-en="Resources" data-sw="Rasilimali">Resources</span>
                        </a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <select id="languageSelect" onchange="changeLanguage()" class="form-select form-select-sm me-3" style="width: auto;">
                        <option value="en">ðŸ‡¬ðŸ‡§ English</option>
                        <option value="sw">ðŸ‡°ðŸ‡ª Kiswahili</option>
                    </select>
                    
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>
                            <span id="userName">Student</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item active" href="profile.html">
                                <i class="fas fa-user me-2"></i>Profile
                            </a></li>
                            <li><a class="dropdown-item" href="profile.html">
                                <i class="fas fa-history me-2"></i>History
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="signOut()">
                                <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-4">

        <!-- Profile Header -->
        <div class="mb-4">
            <div class="card profile-card rounded-4 overflow-hidden">
                <div class="profile-header gradient-bg text-white p-4 p-md-5 position-relative">
                    <img src="/images/homepage-img.png" 
                         alt="Profile background" 
                         class="position-absolute top-0 start-0 w-100 h-100 object-fit-cover opacity-20">
                    
                    <div class="position-relative">
                        <div class="row align-items-center">
                            <!-- Profile Picture -->
                            <div class="col-md-3 text-center text-md-start mb-3 mb-md-0">
                                <div class="position-relative d-inline-block">
                                    <div class="bg-white bg-opacity-20 rounded-circle d-flex align-items-center justify-content-center floating-animation" style="width: 96px; height: 96px;">
                                        <i class="fas fa-user text-white fs-1" id="profileIcon"></i>
                                    </div>
                                    <button onclick="changeProfilePicture()" class="btn btn-light btn-sm rounded-circle position-absolute bottom-0 end-0" style="width: 32px; height: 32px;">
                                        <i class="fas fa-camera small"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Profile Info -->
                            <div class="col-md-6 text-center text-md-start">
                                <h1 class="h2 fw-bold mb-2" id="profileName">
                                    <span data-en="Student Profile" data-sw="Wasifu wa Mwanafunzi">Student Profile</span>
                                </h1>
                                <p class="opacity-90 mb-3" id="profileSubtitle">
                                    <span data-en="Exploring CBE Career Pathways" data-sw="Kuchunguza Njia za Kazi za CBE">Exploring CBE Career Pathways</span>
                                </p>
                                
                                <!-- Quick Stats -->
                                <div class="row g-2 text-center">
                                    <div class="col-4">
                                        <div class="bg-white bg-opacity-20 rounded-3 p-2">
                                            <div class="small opacity-75">
                                                <span data-en="Level" data-sw="Kiwango">Level</span>
                                            </div>
                                            <div class="fw-bold" id="userLevel">1</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="bg-white bg-opacity-20 rounded-3 p-2">
                                            <div class="small opacity-75">
                                                <span data-en="XP Points" data-sw="Alama za XP">XP Points</span>
                                            </div>
                                            <div class="fw-bold" id="userXP">0</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="bg-white bg-opacity-20 rounded-3 p-2">
                                            <div class="small opacity-75">
                                                <span data-en="Joined" data-sw="Alijiunge">Joined</span>
                                            </div>
                                            <div class="fw-bold" id="joinDate">2025</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="col-md-3 text-center text-md-end">
                                <div class="d-flex flex-column gap-2">
                                    <a href="dashboard.html" class="btn btn-light">
                                        <i class="fas fa-chart-line me-2"></i>
                                        <span data-en="View Progress" data-sw="Ona Maendeleo">View Progress</span>
                                    </a>
                                    <button onclick="exportProfile()" class="btn btn-outline-light">
                                        <i class="fas fa-download me-2"></i>
                                        <span data-en="Export Profile" data-sw="Hamisha Wasifu">Export Profile</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Content -->
        <div class="row g-4">
            <!-- Left Column -->
            <div class="col-lg-8">
                
                <!-- Personal Information -->
                <div class="card profile-card rounded-4 mb-4">
                    <div class="card-body p-4 p-md-5">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="fw-bold mb-0">
                                <span data-en="Personal Information" data-sw="Maelezo ya Kibinafsi">Personal Information</span>
                            </h3>
                            <button onclick="editPersonalInfo()" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-edit me-1"></i>
                                <span data-en="Edit" data-sw="Hariri">Edit</span>
                            </button>
                        </div>
                        
                        <form id="personalInfoForm" onsubmit="savePersonalInfo(event)">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">
                                        <span data-en="Full Name" data-sw="Jina Kamili">Full Name</span>
                                    </label>
                                    <input type="text" id="fullName" class="form-control" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">
                                        <span data-en="Email Address" data-sw="Barua Pepe">Email Address</span>
                                    </label>
                                    <input type="email" id="email" class="form-control bg-light" disabled readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">
                                        <span data-en="School/Institution" data-sw="Shule/Taasisi">School/Institution</span>
                                    </label>
                                    <input type="text" id="school" class="form-control" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">
                                        <span data-en="Current Grade" data-sw="Darasa la Sasa">Current Grade</span>
                                    </label>
                                    <select id="grade" class="form-select" disabled>
                                        <option value="">Select Grade</option>
                                        <option value="Grade 7">Grade 7</option>
                                        <option value="Grade 8">Grade 8</option>
                                        <option value="Grade 9">Grade 9</option>
                                        <option value="Grade 10">Grade 10</option>
                                        <option value="Grade 11">Grade 11</option>
                                        <option value="Grade 12">Grade 12</option>
                                        <option value="University">University</option>
                                        <option value="Graduate">Graduate</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">
                                        <span data-en="County" data-sw="Kaunti">County</span>
                                    </label>
                                    <select id="county" class="form-select" disabled>
                                        <option value="">Select County</option>
                                        <option value="Nairobi">Nairobi</option>
                                        <option value="Mombasa">Mombasa</option>
                                        <option value="Kiambu">Kiambu</option>
                                        <option value="Nakuru">Nakuru</option>
                                        <option value="Machakos">Machakos</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">
                                        <span data-en="Phone Number" data-sw="Namba ya Simu">Phone Number</span>
                                    </label>
                                    <input type="tel" id="phone" class="form-control" disabled>
                                </div>
                            </div>
                            
                            <div id="editButtons" class="d-none mt-4 text-end">
                                <button type="button" onclick="cancelEdit()" class="btn btn-outline-secondary me-2">
                                    <span data-en="Cancel" data-sw="Ghairi">Cancel</span>
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <span data-en="Save Changes" data-sw="Hifadhi Mabadiliko">Save Changes</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Career Preferences -->
                <div class="card profile-card rounded-4 mb-4">
                    <div class="card-body p-4 p-md-5">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="fw-bold mb-0">
                                <span data-en="Career Preferences" data-sw="Mapendeleo ya Kazi">Career Preferences</span>
                            </h3>
                            <button onclick="updatePreferences()" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-sync me-1"></i>
                                <span data-en="Update" data-sw="Sasisha">Update</span>
                            </button>
                        </div>
                        
                        <!-- Preferred Pathway -->
                        <div class="mb-4">
                            <label class="form-label fw-medium mb-3">
                                <span data-en="Preferred CBE Pathway" data-sw="Njia ya CBE Unayopendelea">Preferred CBE Pathway</span>
                            </label>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="radio" id="stem" name="pathway" value="stem" class="d-none">
                                    <label for="stem" class="pathway-option card border-2 p-3 w-100 d-flex align-items-center">
                                        <div class="bg-primary bg-opacity-10 rounded-3 p-2 me-3">
                                            <i class="fas fa-flask text-primary"></i>
                                        </div>
                                        <span class="fw-medium">STEM</span>
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <input type="radio" id="social" name="pathway" value="social" class="d-none">
                                    <label for="social" class="pathway-option card border-2 p-3 w-100 d-flex align-items-center">
                                        <div class="bg-success bg-opacity-10 rounded-3 p-2 me-3">
                                            <i class="fas fa-users text-success"></i>
                                        </div>
                                        <span class="fw-medium">Social Sciences</span>
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <input type="radio" id="arts" name="pathway" value="arts" class="d-none">
                                    <label for="arts" class="pathway-option card border-2 p-3 w-100 d-flex align-items-center">
                                        <div class="bg-info bg-opacity-10 rounded-3 p-2 me-3">
                                            <i class="fas fa-palette text-info"></i>
                                        </div>
                                        <span class="fw-medium">Arts & Sports</span>
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <input type="radio" id="technical" name="pathway" value="technical" class="d-none">
                                    <label for="technical" class="pathway-option card border-2 p-3 w-100 d-flex align-items-center">
                                        <div class="bg-warning bg-opacity-10 rounded-3 p-2 me-3">
                                            <i class="fas fa-tools text-warning"></i>
                                        </div>
                                        <span class="fw-medium">Technical</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Career Interests -->
                        <div class="mb-4">
                            <label class="form-label fw-medium mb-3">
                                <span data-en="Career Interests" data-sw="Maslahi ya Kazi">Career Interests</span>
                            </label>
                            <div id="careerInterests" class="d-flex flex-wrap gap-2">
                                <!-- Interest tags will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Future Goals -->
                        <div>
                            <label class="form-label fw-medium">
                                <span data-en="Future Goals" data-sw="Malengo ya Baadaye">Future Goals</span>
                            </label>
                            <textarea id="futureGoals" rows="4" class="form-control" placeholder="Describe your career aspirations and goals..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div class="card profile-card rounded-4">
                    <div class="card-body p-4 p-md-5">
                        <h3 class="fw-bold mb-4">
                            <span data-en="Account Settings" data-sw="Mipangilio ya Akaunti">Account Settings</span>
                        </h3>
                        
                        <!-- Notification Preferences -->
                        <div class="mb-4">
                            <h5 class="fw-semibold mb-3">
                                <span data-en="Notification Preferences" data-sw="Mapendeleo ya Arifa">Notification Preferences</span>
                            </h5>
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input type="checkbox" id="emailNotifications" class="form-check-input">
                                        <label class="form-check-label" for="emailNotifications">
                                            <span data-en="Email notifications for new career opportunities" data-sw="Arifa za barua pepe kwa fursa mpya za kazi">Email notifications for new career opportunities</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input type="checkbox" id="assessmentReminders" class="form-check-input">
                                        <label class="form-check-label" for="assessmentReminders">
                                            <span data-en="Assessment completion reminders" data-sw="Vikumbusho vya ukamilishaji wa tathmini">Assessment completion reminders</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input type="checkbox" id="scholarshipAlerts" class="form-check-input">
                                        <label class="form-check-label" for="scholarshipAlerts">
                                            <span data-en="Scholarship and funding alerts" data-sw="Arifa za ufadhili na ruzuku">Scholarship and funding alerts</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Privacy Settings -->
                        <div class="mb-4">
                            <h5 class="fw-semibold mb-3">
                                <span data-en="Privacy Settings" data-sw="Mipangilio ya Faragha">Privacy Settings</span>
                            </h5>
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input type="checkbox" id="profileVisibility" class="form-check-input">
                                        <label class="form-check-label" for="profileVisibility">
                                            <span data-en="Make profile visible to career counselors" data-sw="Fanya wasifu uonekane kwa washauri wa kazi">Make profile visible to career counselors</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input type="checkbox" id="dataSharing" class="form-check-input">
                                        <label class="form-check-label" for="dataSharing">
                                            <span data-en="Share anonymized data for research purposes" data-sw="Shiriki data isiyojulikana kwa madhumuni ya utafiti">Share anonymized data for research purposes</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Actions -->
                        <div>
                            <h5 class="fw-semibold mb-3">
                                <span data-en="Security" data-sw="Usalama">Security</span>
                            </h5>
                            <div class="d-flex flex-column flex-md-row gap-3">
                                <button onclick="changePassword()" class="btn btn-outline-secondary">
                                    <i class="fas fa-key me-2"></i>
                                    <span data-en="Change Password" data-sw="Badilisha Nenosiri">Change Password</span>
                                </button>
                                <button onclick="showDeleteAccountModal()" class="btn btn-outline-danger">
                                    <i class="fas fa-trash me-2"></i>
                                    <span data-en="Delete Account" data-sw="Futa Akaunti">Delete Account</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-4">
                
                <!-- Progress Overview -->
                <div class="card profile-card rounded-4 mb-4">
                    <div class="card-body p-4">
                        <h4 class="fw-bold mb-4">
                            <span data-en="Progress Overview" data-sw="Muhtasari wa Maendeleo">Progress Overview</span>
                        </h4>
                        
                        <!-- Level Progress -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small fw-medium">
                                    <span data-en="Current Level" data-sw="Kiwango cha Sasa">Current Level</span>
                                </span>
                                <span class="small text-primary fw-bold" id="levelProgress">Level 1</span>
                            </div>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-gradient" id="levelBar" style="width: 30%; background: linear-gradient(90deg, var(--primary), var(--accent));"></div>
                            </div>
                            <div class="small text-muted">
                                <span data-en="30/100 XP to next level" data-sw="30/100 XP hadi kiwango kijacho">30/100 XP to next level</span>
                            </div>
                        </div>

                        <!-- Completion Stats -->
                        <div class="row g-3 text-center">
                            <div class="col-6">
                                <div class="h4 mb-1 text-primary" id="assessmentsCompleted">0</div>
                                <div class="small text-muted">
                                    <span data-en="Assessments" data-sw="Tathmini">Assessments</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="h4 mb-1 text-info" id="scenariosCompleted">0</div>
                                <div class="small text-muted">
                                    <span data-en="Scenarios" data-sw="Hali">Scenarios</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="h4 mb-1 text-warning" id="careersExplored">0</div>
                                <div class="small text-muted">
                                    <span data-en="Careers" data-sw="Kazi">Careers</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="h4 mb-1 text-success" id="resourcesViewed">0</div>
                                <div class="small text-muted">
                                    <span data-en="Resources" data-sw="Rasilimali">Resources</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Achievements -->
                <div class="card profile-card rounded-4 mb-4">
                    <div class="card-body p-4">
                        <h4 class="fw-bold mb-4">
                            <span data-en="Recent Achievements" data-sw="Mafanikio ya Hivi Karibuni">Recent Achievements</span>
                        </h4>
                        
                        <div id="recentAchievements" class="d-flex flex-column gap-3">
                            <!-- Achievement items will be populated by JavaScript -->
                        </div>
                        
                        <div class="mt-3">
                            <a href="dashboard.html" class="btn btn-outline-primary btn-sm w-100">
                                <span data-en="View All Achievements" data-sw="Ona Mafanikio Yote">View All Achievements</span>
                                <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card profile-card rounded-4">
                    <div class="card-body p-4">
                        <h4 class="fw-bold mb-4">
                            <span data-en="Quick Actions" data-sw="Vitendo vya Haraka">Quick Actions</span>
                        </h4>
                        
                        <div class="d-grid gap-3">
                            <a href="assessment.html" class="btn btn-primary">
                                <i class="fas fa-clipboard-list me-2"></i>
                                <span data-en="Take New Assessment" data-sw="Chukua Tathmini Mpya">Take New Assessment</span>
                            </a>
                            
                            <a href="dashboard.html" class="btn btn-info">
                                <i class="fas fa-chart-line me-2"></i>
                                <span data-en="View Progress" data-sw="Ona Maendeleo">View Progress</span>
                            </a>
                            
                            <button onclick="exportProfile()" class="btn btn-warning">
                                <i class="fas fa-download me-2"></i>
                                <span data-en="Export Profile" data-sw="Hamisha Wasifu">Export Profile</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Change Password Modal -->
    <div class="modal fade" id="passwordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <span data-en="Change Password" data-sw="Badilisha Nenosiri">Change Password</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="passwordForm" onsubmit="updatePassword(event)">
                        <div class="mb-3">
                            <label class="form-label">
                                <span data-en="Current Password" data-sw="Nenosiri la Sasa">Current Password</span>
                            </label>
                            <input type="password" id="currentPassword" required class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                <span data-en="New Password" data-sw="Nenosiri Jipya">New Password</span>
                            </label>
                            <input type="password" id="newPassword" required minlength="6" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">
                                <span data-en="Confirm New Password" data-sw="Thibitisha Nenosiri Jipya">Confirm New Password</span>
                            </label>
                            <input type="password" id="confirmPassword" required minlength="6" class="form-control">
                        </div>
                        
                        <div class="d-flex justify-content-end gap-3">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                <span data-en="Cancel" data-sw="Ghairi">Cancel</span>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span data-en="Update Password" data-sw="Sasisha Nenosiri">Update Password</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-5">
                    <div class="bg-danger bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="fas fa-exclamation-triangle text-danger fs-4"></i>
                    </div>
                    <h2 class="fw-bold mb-3">
                        <span data-en="Delete Account" data-sw="Futa Akaunti">Delete Account</span>
                    </h2>
                    <p class="text-muted mb-4">
                        <span data-en="Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently lost." 
                              data-sw="Una uhakika unataka kufuta akaunti yako? Kitendo hiki hakiwezi kubatilishwa na data yako yote itapotea kabisa.">
                            Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently lost.
                        </span>
                    </p>
                    
                    <div class="d-flex justify-content-center gap-3">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            <span data-en="Cancel" data-sw="Ghairi">Cancel</span>
                        </button>
                        <button onclick="deleteAccount()" class="btn btn-danger">
                            <span data-en="Delete Account" data-sw="Futa Akaunti">Delete Account</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start mb-2 mb-md-0">
                    <p class="mb-0 small text-light-emphasis">
                        Â© 2025 CBE Career Guide. All rights reserved.
                    </p>
                    <p class="mb-0 small text-muted">
                        Code Champ Project - Career Guidance Platform
                    </p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0 small fw-medium">
                        Developed by <span class="text-warning fw-bold">Code Champ</span> 2025
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let userProfile = null;
        let isEditing = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            initializeLanguage();
        });

        function initializeLanguage() {
            const languageSelect = document.getElementById('languageSelect');
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
            languageSelect.value = savedLanguage;
            changeLanguage();
        }

        async function checkAuthState() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                await loadUserProfile();
                await loadUserStats();
                await loadRecentAchievements();
            } else {
                window.location.href = 'index.html';
            }
        }

        async function loadUserProfile() {
            try {
                // Load user profile data
                const { data: profile, error } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .single();

                if (!error && profile) {
                    userProfile = profile;
                    populateProfileForm(profile);
                } else {
                    // Create default profile
                    await createDefaultProfile();
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        async function createDefaultProfile() {
            const defaultProfile = {
                user_id: currentUser.id,
                full_name: currentUser.user_metadata?.full_name || '',
                email: currentUser.email,
                school: '',
                grade: '',
                county: '',
                phone: '',
                created_at: new Date().toISOString()
            };

            try {
                const { error } = await supabase
                    .from('user_profiles')
                    .insert([defaultProfile]);

                if (!error) {
                    userProfile = defaultProfile;
                    populateProfileForm(defaultProfile);
                }
            } catch (error) {
                console.error('Error creating default profile:', error);
            }
        }

        function populateProfileForm(profile) {
            document.getElementById('profileName').textContent = profile.full_name || 'Student';
            document.getElementById('userName').textContent = profile.full_name || 'Student';
            document.getElementById('fullName').value = profile.full_name || '';
            document.getElementById('email').value = profile.email || '';
            document.getElementById('school').value = profile.school || '';
            document.getElementById('grade').value = profile.grade || '';
            document.getElementById('county').value = profile.county || '';
            document.getElementById('phone').value = profile.phone || '';
            
            // Format join date
            if (profile.created_at) {
                const date = new Date(profile.created_at);
                document.getElementById('joinDate').textContent = date.getFullYear();
            }
        }

        async function loadUserStats() {
            try {
                // Load user activities
                const { data: activities, error } = await supabase
                    .from('user_activities')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (!error) {
                    const assessments = activities.filter(a => a.activity_type === 'assessment_completed').length;
                    const scenarios = activities.filter(a => a.activity_type === 'scenario_completed').length;
                    const careers = [...new Set(activities.filter(a => a.activity_type === 'career_interaction').map(a => a.activity_data?.name))].length;
                    const resources = activities.filter(a => a.activity_type === 'resource_viewed').length;

                    document.getElementById('assessmentsCompleted').textContent = assessments;
                    document.getElementById('scenariosCompleted').textContent = scenarios;
                    document.getElementById('careersExplored').textContent = careers;
                    document.getElementById('resourcesViewed').textContent = resources;

                    // Calculate level and XP
                    const totalXP = activities.length * 10;
                    const level = Math.floor(totalXP / 100) + 1;
                    const currentLevelXP = totalXP % 100;

                    document.getElementById('userLevel').textContent = level;
                    document.getElementById('userXP').textContent = totalXP;
                    document.getElementById('levelProgress').textContent = `Level ${level}`;
                    document.getElementById('levelBar').style.width = `${currentLevelXP}%`;
                }
            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        }

        async function loadRecentAchievements() {
            const achievements = [
                { icon: 'fas fa-trophy', title: 'First Assessment', description: 'Completed your first career assessment', color: 'text-warning' },
                { icon: 'fas fa-star', title: 'Explorer', description: 'Viewed 5 different careers', color: 'text-primary' },
                { icon: 'fas fa-certificate', title: 'Active Learner', description: 'Used the platform for 7 days', color: 'text-success' }
            ];

            const container = document.getElementById('recentAchievements');
            container.innerHTML = achievements.map(achievement => `
                <div class="d-flex align-items-center p-3 bg-light rounded-3">
                    <div class="bg-white rounded-3 p-2 me-3">
                        <i class="${achievement.icon} ${achievement.color}"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="fw-medium">${achievement.title}</div>
                        <div class="small text-muted">${achievement.description}</div>
                    </div>
                </div>
            `).join('');
        }

        function editPersonalInfo() {
            isEditing = true;
            const inputs = ['fullName', 'school', 'grade', 'county', 'phone'];
            inputs.forEach(id => {
                document.getElementById(id).disabled = false;
            });
            document.getElementById('editButtons').classList.remove('d-none');
        }

        function cancelEdit() {
            isEditing = false;
            const inputs = ['fullName', 'school', 'grade', 'county', 'phone'];
            inputs.forEach(id => {
                document.getElementById(id).disabled = true;
            });
            document.getElementById('editButtons').classList.add('d-none');
            
            // Restore original values
            if (userProfile) {
                populateProfileForm(userProfile);
            }
        }

        async function savePersonalInfo(event) {
            event.preventDefault();
            
            const updatedProfile = {
                full_name: document.getElementById('fullName').value,
                school: document.getElementById('school').value,
                grade: document.getElementById('grade').value,
                county: document.getElementById('county').value,
                phone: document.getElementById('phone').value,
                updated_at: new Date().toISOString()
            };

            try {
                const { error } = await supabase
                    .from('user_profiles')
                    .update(updatedProfile)
                    .eq('user_id', currentUser.id);

                if (error) throw error;

                userProfile = { ...userProfile, ...updatedProfile };
                cancelEdit();
                showSuccessMessage('Profile updated successfully!');
                
                // Update display name
                document.getElementById('profileName').textContent = updatedProfile.full_name;
                document.getElementById('userName').textContent = updatedProfile.full_name;
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showErrorMessage('Failed to update profile');
            }
        }

        function updatePreferences() {
            showSuccessMessage('Preferences updated successfully!');
        }

        function changePassword() {
            const modal = new bootstrap.Modal(document.getElementById('passwordModal'));
            modal.show();
        }

        async function updatePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                showErrorMessage('New passwords do not match');
                return;
            }

            try {
                const { error } = await supabase.auth.updateUser({
                    password: newPassword
                });

                if (error) throw error;

                const modal = bootstrap.Modal.getInstance(document.getElementById('passwordModal'));
                modal.hide();
                showSuccessMessage('Password updated successfully!');
                
            } catch (error) {
                console.error('Error updating password:', error);
                showErrorMessage('Failed to update password');
            }
        }

        function showDeleteAccountModal() {
            const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
            modal.show();
        }

        async function deleteAccount() {
            try {
                // Delete user data
                await supabase
                    .from('user_profiles')
                    .delete()
                    .eq('user_id', currentUser.id);

                await supabase
                    .from('user_activities')
                    .delete()
                    .eq('user_id', currentUser.id);

                // Delete user account
                const { error } = await supabase.auth.admin.deleteUser(currentUser.id);
                
                if (error) throw error;

                window.location.href = 'index.html';
                
            } catch (error) {
                console.error('Error deleting account:', error);
                showErrorMessage('Failed to delete account');
            }
        }

        function changeProfilePicture() {
            showSuccessMessage('Profile picture update feature coming soon!');
        }

        function exportProfile() {
            showSuccessMessage('Profile export feature coming soon!');
        }

        async function signOut() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                window.location.href = 'index.html';
                
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }

        function changeLanguage() {
            const select = document.getElementById('languageSelect');
            const currentLanguage = select.value;
            localStorage.setItem('selectedLanguage', currentLanguage);
            
            document.querySelectorAll('[data-en]').forEach(element => {
                if (currentLanguage === 'en') {
                    element.textContent = element.getAttribute('data-en');
                } else {
                    element.textContent = element.getAttribute('data-sw');
                }
            });
        }

        function showSuccessMessage(message) {
            const toastContainer = document.createElement('div');
            toastContainer.className = 'position-fixed top-0 end-0 p-3';
            toastContainer.style.zIndex = '1050';
            toastContainer.innerHTML = `
                <div class="toast align-items-center text-white bg-success border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-check-circle me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            document.body.appendChild(toastContainer);
            
            const toast = new bootstrap.Toast(toastContainer.querySelector('.toast'));
            toast.show();
            
            setTimeout(() => {
                toastContainer.remove();
            }, 3000);
        }

        function showErrorMessage(message) {
            const toastContainer = document.createElement('div');
            toastContainer.className = 'position-fixed top-0 end-0 p-3';
            toastContainer.style.zIndex = '1050';
            toastContainer.innerHTML = `
                <div class="toast align-items-center text-white bg-danger border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-exclamation-circle me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            document.body.appendChild(toastContainer);
            
            const toast = new bootstrap.Toast(toastContainer.querySelector('.toast'));
            toast.show();
            
            setTimeout(() => {
                toastContainer.remove();
            }, 3000);
        }
    </script>

</body>
</html>