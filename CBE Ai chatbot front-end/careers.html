<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Database - CBE Career Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #5D5CDE;
            --secondary: #FF6B35;
            --accent: #4ECDC4;
            --success: #45B7D1;
            --code-champ-blue: #5D5CDE;
            --code-champ-green: #10B981;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #e6efff 50%, #f0f8ff 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        .gradient-code-champ {
            background: linear-gradient(135deg, var(--code-champ-blue) 0%, var(--code-champ-green) 100%);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary);
            border-color: var(--primary);
            opacity: 0.9;
        }
        
        .text-primary {
            color: var(--primary) !important;
        }
        
        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .career-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .career-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .filter-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .search-box {
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(93, 92, 222, 0.25);
        }
        
        .salary-range {
            background: linear-gradient(90deg, #10b981, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .footer {
            background-color: #212529;
        }

        .code-champ-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }

        .page-header {
            background: url('/images/school-boy-conducting-science-experiment-with-test-tubes-classroom_13339-378895.jpg') center/cover;
            position: relative;
            color: white;
            padding: 80px 0;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.9) 0%, rgba(16, 185, 129, 0.8) 100%);
        }

        .page-header-content {
            position: relative;
            z-index: 2;
        }

        .official-banner {
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            to { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
        }

        .pulse-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <!-- Navigation Header -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top border-bottom">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <img src="/images/code champ logo.jpg" 
                     alt="Code Champ Logo" class="code-champ-logo me-3">
                <div>
                    <span class="fw-bold fs-4 text-primary">CBE Career Guide</span>
                    <div class="small text-muted d-none d-sm-block">
                        <span data-en="A Code Champ Project" data-sw="Mradi wa Code Champ">A Code Champ Project</span>
                    </div>
                </div>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="chat.html">
                            <i class="fas fa-comments me-2"></i>
                            <span data-en="AI Chat" data-sw="Mazungumzo ya AI">AI Chat</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="assessment.html">
                            <i class="fas fa-clipboard-list me-2"></i>
                            <span data-en="Assessment" data-sw="Tathmini">Assessment</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pathways.html">
                            <i class="fas fa-route me-2"></i>
                            <span data-en="Pathways" data-sw="Njia">Pathways</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="careers.html">
                            <i class="fas fa-briefcase me-2"></i>
                            <span data-en="Careers" data-sw="Kazi">Careers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="scenarios.html">
                            <i class="fas fa-gamepad me-2"></i>
                            <span data-en="Scenarios" data-sw="Hali">Scenarios</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="resources.html">
                            <i class="fas fa-book me-2"></i>
                            <span data-en="Resources" data-sw="Rasilimali">Resources</span>
                        </a>
                    </li>
                </ul>
                
                <div class="d-flex align-items-center">
                    <select id="languageSelect" onchange="changeLanguage()" class="form-select form-select-sm me-3" style="width: auto;">
                        <option value="en">ðŸ‡¬ðŸ‡§ English</option>
                        <option value="sw">ðŸ‡°ðŸ‡ª Kiswahili</option>
                    </select>
                    
                    <div id="authSection" class="d-none">
                        <div id="notLoggedIn" class="d-flex gap-2">
                            <a href="login.html" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-sign-in-alt me-1"></i>
                                <span data-en="Login" data-sw="Ingia">Login</span>
                            </a>
                            <a href="signup.html" class="btn btn-primary btn-sm">
                                <i class="fas fa-user-plus me-1"></i>
                                <span data-en="Sign Up" data-sw="Jisajili">Sign Up</span>
                            </a>
                        </div>
                        
                        <div id="loggedIn" class="d-none">
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user me-1"></i>
                                    <span id="userName">Student</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="profile.html">
                                        <i class="fas fa-user me-2"></i>Profile
                                    </a></li>
                                    <li><a class="dropdown-item" href="profile.html">
                                        <i class="fas fa-history me-2"></i>History
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="signOut()">
                                        <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container page-header-content">
            <div class="text-center">
                <div class="mb-4">
                    <div class="bg-white bg-opacity-20 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-briefcase text-white fs-1"></i>
                    </div>
                </div>
                <h1 class="display-3 fw-bold mb-4">
                    <span data-en="Career Database" data-sw="Hifadhidata ya Kazi">Career Database</span>
                </h1>
                <p class="lead opacity-90 col-lg-8 mx-auto">
                    <span data-en="Explore over 500 careers with detailed information about requirements, salaries, and growth prospects in Kenya." 
                          data-sw="Chunguza kazi zaidi ya 500 zenye maelezo ya kina kuhusu mahitaji, mishahara, na matarajio ya ukuaji nchini Kenya.">
                        Explore over 500 careers with detailed information about requirements, salaries, and growth prospects in Kenya.
                    </span>
                </p>
                <div class="bg-white bg-opacity-20 rounded-pill px-4 py-2 d-inline-block mt-3">
                    <small>
                        <i class="fas fa-lightbulb me-2"></i>
                        <span data-en="Powered by Code Champ Career Intelligence" data-sw="Inaendeshwa na Akili ya Kazi ya Code Champ">Powered by Code Champ Career Intelligence</span>
                    </small>
                </div>
            </div>
        </div>
    </section>

    <!-- Official Government Resource Banner -->
    <div class="container py-4">
        <div class="card border-0 shadow-lg official-banner" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);">
            <div class="card-body text-white p-4 p-md-5">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-white bg-opacity-20 rounded-3 p-3 me-4">
                                <i class="fas fa-briefcase fs-1 pulse-icon"></i>
                            </div>
                            <div>
                                <h3 class="mb-1 fw-bold">
                                    <span data-en="Official Career Database" data-sw="Hifadhidata Rasmi ya Kazi">Official Career Database</span>
                                </h3>
                                <p class="mb-0 opacity-75">
                                    <span data-en="Ministry of Education - Career Information Portal" data-sw="Wizara ya Elimu - Mlango wa Habari za Kazi">Ministry of Education - Career Information Portal</span>
                                </p>
                            </div>
                        </div>
                        <p class="mb-4 opacity-90">
                            <span data-en="Explore the official government database of career opportunities with comprehensive information about each profession, requirements, and prospects in Kenya." 
                                  data-sw="Chunguza hifadhidata rasmi ya serikali ya fursa za kazi zenye maelezo ya kina kuhusu kila taaluma, mahitaji, na matarajio nchini Kenya.">
                                Explore the official government database of career opportunities with comprehensive information about each profession, requirements, and prospects in Kenya.
                            </span>
                        </p>
                        <div class="d-flex align-items-center text-warning">
                            <i class="fas fa-shield-alt me-2"></i>
                            <small class="fw-medium">
                                <span data-en="Verified Official Source" data-sw="Chanzo Rasmi Kilichothibitishwa">Verified Official Source</span>
                            </small>
                        </div>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <a href="https://selection.education.go.ke/possible-careers" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="btn btn-light btn-lg px-4 py-3 fw-bold shadow-lg">
                            <i class="fas fa-external-link-alt me-2"></i>
                            <span data-en="View Official Careers" data-sw="Ona Kazi Rasmi">View Official Careers</span>
                        </a>
                        <p class="small mt-2 mb-0 opacity-75">
                            <span data-en="Opens in new tab" data-sw="Inafungua katika kichupo kipya">Opens in new tab</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container py-5">

        <!-- Search and Filters -->
        <div class="row mb-5">
            <!-- Search Bar -->
            <div class="col-lg-8 mb-4">
                <div class="card filter-card rounded-4 p-4">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text border-0 bg-light">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" id="searchInput" class="form-control search-box border-0 bg-light" 
                               placeholder="Search careers (e.g., doctor, engineer, teacher)..." 
                               oninput="filterCareers()">
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="col-lg-4 mb-4">
                <div class="card filter-card rounded-4 p-4 text-center">
                    <h3 class="text-primary mb-1" id="careerCount">500+</h3>
                    <p class="text-muted mb-0">
                        <span data-en="Careers Available" data-sw="Kazi Zinazopatikana">Careers Available</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Filter Tabs -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card filter-card rounded-4 p-4">
                    <ul class="nav nav-pills nav-fill" id="pathwayTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="all-tab" data-bs-toggle="pill" data-bs-target="#all-careers" 
                                    type="button" role="tab" onclick="filterByPathway('all')">
                                <i class="fas fa-list me-2"></i>
                                <span data-en="All Careers" data-sw="Kazi Zote">All Careers</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="stem-tab" data-bs-toggle="pill" data-bs-target="#stem-careers" 
                                    type="button" role="tab" onclick="filterByPathway('stem')">
                                <i class="fas fa-flask me-2"></i>
                                STEM
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="social-tab" data-bs-toggle="pill" data-bs-target="#social-careers" 
                                    type="button" role="tab" onclick="filterByPathway('social')">
                                <i class="fas fa-users me-2"></i>
                                <span data-en="Social" data-sw="Kijamii">Social</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="arts-tab" data-bs-toggle="pill" data-bs-target="#arts-careers" 
                                    type="button" role="tab" onclick="filterByPathway('arts')">
                                <i class="fas fa-palette me-2"></i>
                                <span data-en="Arts" data-sw="Sanaa">Arts</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="technical-tab" data-bs-toggle="pill" data-bs-target="#technical-careers" 
                                    type="button" role="tab" onclick="filterByPathway('technical')">
                                <i class="fas fa-tools me-2"></i>
                                <span data-en="Technical" data-sw="Kiufundi">Technical</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Career Cards Grid -->
        <div class="row g-4" id="careersGrid">
            <!-- Career cards will be populated by JavaScript -->
        </div>

        <!-- Load More Button -->
        <div class="text-center mt-5">
            <button id="loadMoreBtn" onclick="loadMoreCareers()" class="btn btn-outline-primary btn-lg">
                <i class="fas fa-plus me-2"></i>
                <span data-en="Load More Careers" data-sw="Pakia Kazi Zaidi">Load More Careers</span>
            </button>
        </div>

        <!-- Additional Official Link Section -->
        <div class="mt-5 pt-5 border-top">
            <div class="text-center">
                <h3 class="fw-bold mb-4">
                    <span data-en="Need More Career Information?" data-sw="Unahitaji Maelezo Zaidi ya Kazi?">Need More Career Information?</span>
                </h3>
                <p class="lead text-muted mb-4">
                    <span data-en="Visit the official Ministry of Education career database for comprehensive career guidance and requirements." 
                          data-sw="Tembelea hifadhidata rasmi ya kazi ya Wizara ya Elimu kwa mwongozo wa kina wa kazi na mahitaji.">
                        Visit the official Ministry of Education career database for comprehensive career guidance and requirements.
                    </span>
                </p>
                <a href="https://selection.education.go.ke/possible-careers" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   class="btn btn-primary btn-lg">
                    <i class="fas fa-external-link-alt me-2"></i>
                    <span data-en="Official Career Database" data-sw="Hifadhidata Rasmi ya Kazi">Official Career Database</span>
                </a>
            </div>
        </div>

    </main>

    <!-- Career Detail Modal -->
    <div class="modal fade" id="careerModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="careerModalContent">
                    <!-- Career details will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start mb-2 mb-md-0">
                    <p class="mb-0 small text-light-emphasis">
                        Â© 2025 CBE Career Guide. All rights reserved.
                    </p>
                    <p class="mb-0 small text-muted">
                        Code Champ Project - Career Guidance Platform
                    </p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0 small fw-medium">
                        Developed by <span class="text-warning fw-bold">Code Champ</span> 2025
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;
        let allCareers = [];
        let filteredCareers = [];
        let displayedCareers = 0;
        const careersPerPage = 12;

        // Sample career data - replace with actual database
        const careerDatabase = [
            // STEM Careers
            {
                id: 1,
                name: 'Software Developer',
                pathway: 'stem',
                description: 'Design, develop, and maintain software applications and systems.',
                salary: 'KES 80,000 - 200,000',
                education: 'Bachelor\'s Degree in Computer Science or related field',
                skills: ['Programming', 'Problem Solving', 'Mathematics', 'Logic'],
                workEnvironment: 'Office/Remote',
                jobOutlook: 'Excellent - Growing field',
                requirements: 'Strong mathematical background, KCSE C+ with good performance in Mathematics and English',
                icon: 'fas fa-code',
                color: 'primary'
            },
            {
                id: 2,
                name: 'Medical Doctor',
                pathway: 'stem',
                description: 'Diagnose and treat illnesses, injuries, and other health conditions.',
                salary: 'KES 120,000 - 400,000',
                education: 'Bachelor of Medicine and Bachelor of Surgery (MBChB)',
                skills: ['Medical Knowledge', 'Empathy', 'Communication', 'Critical Thinking'],
                workEnvironment: 'Hospitals/Clinics',
                jobOutlook: 'Excellent - Always in demand',
                requirements: 'KCSE A- minimum, excellent performance in Biology, Chemistry, Physics, and Mathematics',
                icon: 'fas fa-stethoscope',
                color: 'primary'
            },
            {
                id: 3,
                name: 'Civil Engineer',
                pathway: 'stem',
                description: 'Design and oversee construction of infrastructure projects.',
                salary: 'KES 60,000 - 180,000',
                education: 'Bachelor\'s Degree in Civil Engineering',
                skills: ['Technical Drawing', 'Mathematics', 'Project Management', 'Problem Solving'],
                workEnvironment: 'Office/Field',
                jobOutlook: 'Good - Infrastructure development',
                requirements: 'KCSE C+ with strong performance in Mathematics, Physics, and Chemistry',
                icon: 'fas fa-hard-hat',
                color: 'primary'
            },
            
            // Social Sciences Careers
            {
                id: 4,
                name: 'Primary School Teacher',
                pathway: 'social',
                description: 'Educate and guide young learners in their academic and personal development.',
                salary: 'KES 30,000 - 70,000',
                education: 'Diploma/Bachelor\'s in Education',
                skills: ['Communication', 'Patience', 'Creativity', 'Leadership'],
                workEnvironment: 'Schools',
                jobOutlook: 'Good - Always needed',
                requirements: 'KCSE C+ with good performance in teaching subjects',
                icon: 'fas fa-chalkboard-teacher',
                color: 'success'
            },
            {
                id: 5,
                name: 'Lawyer',
                pathway: 'social',
                description: 'Provide legal advice and represent clients in legal matters.',
                salary: 'KES 80,000 - 300,000',
                education: 'Bachelor of Laws (LLB) + Kenya School of Law',
                skills: ['Analytical Thinking', 'Communication', 'Research', 'Negotiation'],
                workEnvironment: 'Law Firms/Courts',
                jobOutlook: 'Good - Growing legal sector',
                requirements: 'KCSE B+ with excellent performance in English and History',
                icon: 'fas fa-gavel',
                color: 'success'
            },
            
            // Arts & Sports Careers
            {
                id: 6,
                name: 'Graphic Designer',
                pathway: 'arts',
                description: 'Create visual content for digital and print media.',
                salary: 'KES 40,000 - 120,000',
                education: 'Diploma/Bachelor\'s in Graphic Design or Fine Arts',
                skills: ['Creativity', 'Design Software', 'Visual Communication', 'Attention to Detail'],
                workEnvironment: 'Studios/Agencies/Freelance',
                jobOutlook: 'Good - Digital marketing growth',
                requirements: 'KCSE C+ with portfolio demonstration',
                icon: 'fas fa-paint-brush',
                color: 'info'
            },
            {
                id: 7,
                name: 'Professional Athlete',
                pathway: 'arts',
                description: 'Compete in sports at professional level.',
                salary: 'KES 25,000 - 500,000+',
                education: 'Sports training and certification',
                skills: ['Physical Fitness', 'Discipline', 'Teamwork', 'Mental Strength'],
                workEnvironment: 'Sports Facilities/Travel',
                jobOutlook: 'Competitive - Limited positions',
                requirements: 'KCSE D+ with exceptional athletic ability',
                icon: 'fas fa-running',
                color: 'info'
            },
            
            // Technical & Vocational Careers
            {
                id: 8,
                name: 'Electrician',
                pathway: 'technical',
                description: 'Install, maintain, and repair electrical systems.',
                salary: 'KES 35,000 - 80,000',
                education: 'Certificate/Diploma in Electrical Engineering',
                skills: ['Technical Skills', 'Problem Solving', 'Safety Awareness', 'Attention to Detail'],
                workEnvironment: 'Construction Sites/Buildings',
                jobOutlook: 'Excellent - Infrastructure growth',
                requirements: 'KCSE D+ with good performance in Mathematics and Physics',
                icon: 'fas fa-bolt',
                color: 'warning'
            },
            {
                id: 9,
                name: 'Chef',
                pathway: 'technical',
                description: 'Prepare and cook food in restaurants and hotels.',
                salary: 'KES 25,000 - 100,000',
                education: 'Certificate/Diploma in Culinary Arts',
                skills: ['Cooking', 'Creativity', 'Time Management', 'Food Safety'],
                workEnvironment: 'Kitchens/Restaurants',
                jobOutlook: 'Good - Tourism industry growth',
                requirements: 'KCSE D+ with practical skills assessment',
                icon: 'fas fa-utensils',
                color: 'warning'
            }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            loadCareerDatabase();
            initializeLanguage();
        });

        async function checkAuthState() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                showLoggedInState();
            } else {
                showLoggedOutState();
            }
        }

        function showLoggedInState() {
            document.getElementById('notLoggedIn').classList.add('d-none');
            document.getElementById('loggedIn').classList.remove('d-none');
            
            if (currentUser.user_metadata?.full_name) {
                document.getElementById('userName').textContent = currentUser.user_metadata.full_name;
            }
        }

        function showLoggedOutState() {
            document.getElementById('notLoggedIn').classList.remove('d-none');
            document.getElementById('loggedIn').classList.add('d-none');
        }

        async function signOut() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                currentUser = null;
                showLoggedOutState();
                
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }

        function initializeLanguage() {
            const languageSelect = document.getElementById('languageSelect');
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
            languageSelect.value = savedLanguage;
            changeLanguage();
        }

        function loadCareerDatabase() {
            // In a real application, this would fetch from Supabase
            allCareers = [...careerDatabase];
            
            // Add more careers programmatically to reach 500+
            const additionalCareers = generateAdditionalCareers();
            allCareers = [...allCareers, ...additionalCareers];
            
            filteredCareers = [...allCareers];
            displayedCareers = 0;
            
            updateCareerCount();
            loadMoreCareers();
        }

        function generateAdditionalCareers() {
            // Generate additional careers to simulate a larger database
            const templates = [
                { pathway: 'stem', names: ['Data Scientist', 'Biomedical Engineer', 'Pharmacist', 'Veterinarian', 'Architect'], icon: 'fas fa-microscope', color: 'primary' },
                { pathway: 'social', names: ['Social Worker', 'Journalist', 'Diplomat', 'Counselor', 'Librarian'], icon: 'fas fa-handshake', color: 'success' },
                { pathway: 'arts', names: ['Musician', 'Photographer', 'Film Director', 'Fashion Designer', 'Dance Instructor'], icon: 'fas fa-music', color: 'info' },
                { pathway: 'technical', names: ['Mechanic', 'Plumber', 'Carpenter', 'Welder', 'Beautician'], icon: 'fas fa-wrench', color: 'warning' }
            ];
            
            const additional = [];
            let id = 10;
            
            templates.forEach(template => {
                template.names.forEach(name => {
                    additional.push({
                        id: id++,
                        name: name,
                        pathway: template.pathway,
                        description: `Professional ${name.toLowerCase()} with expertise in the field.`,
                        salary: 'KES 35,000 - 150,000',
                        education: 'Relevant training and certification',
                        skills: ['Professional Skills', 'Communication', 'Problem Solving', 'Technical Knowledge'],
                        workEnvironment: 'Various',
                        jobOutlook: 'Good opportunities',
                        requirements: 'KCSE minimum requirements vary',
                        icon: template.icon,
                        color: template.color
                    });
                });
            });
            
            return additional;
        }

        function updateCareerCount() {
            document.getElementById('careerCount').textContent = filteredCareers.length + '+';
        }

        function loadMoreCareers() {
            const grid = document.getElementById('careersGrid');
            const startIndex = displayedCareers;
            const endIndex = Math.min(startIndex + careersPerPage, filteredCareers.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const career = filteredCareers[i];
                const careerCard = createCareerCard(career);
                grid.appendChild(careerCard);
            }
            
            displayedCareers = endIndex;
            
            // Hide load more button if all careers are displayed
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (displayedCareers >= filteredCareers.length) {
                loadMoreBtn.style.display = 'none';
            } else {
                loadMoreBtn.style.display = 'block';
            }
        }

        function createCareerCard(career) {
            const div = document.createElement('div');
            div.className = 'col-lg-4 col-md-6';
            div.innerHTML = `
                <div class="card career-card h-100 rounded-4 p-4" onclick="showCareerDetails(${career.id})">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-${career.color} bg-opacity-10 rounded-3 p-3 me-3">
                            <i class="${career.icon} text-${career.color} fs-4"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="card-title mb-1 text-${career.color}">${career.name}</h5>
                            <small class="text-muted text-uppercase">${career.pathway}</small>
                        </div>
                    </div>
                    
                    <p class="card-text text-muted mb-3">${career.description}</p>
                    
                    <div class="mt-auto">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-${career.color} bg-opacity-10 text-${career.color}">
                                ${career.workEnvironment}
                            </span>
                        </div>
                        
                        <div class="mb-2">
                            <strong class="salary-range">${career.salary}</strong>
                        </div>
                        
                        <button class="btn btn-outline-${career.color} btn-sm w-100">
                            <i class="fas fa-info-circle me-2"></i>
                            View Details
                        </button>
                    </div>
                </div>
            `;
            return div;
        }

        function showCareerDetails(careerId) {
            const career = allCareers.find(c => c.id === careerId);
            if (!career) return;
            
            const modalContent = document.getElementById('careerModalContent');
            modalContent.innerHTML = `
                <div class="text-center mb-4">
                    <div class="bg-${career.color} bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 96px; height: 96px;">
                        <i class="${career.icon} text-${career.color} fs-1"></i>
                    </div>
                    <h1 class="fw-bold text-${career.color}">${career.name}</h1>
                    <p class="lead text-muted">${career.description}</p>
                </div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card border-0 bg-light h-100">
                            <div class="card-body">
                                <h6 class="fw-bold text-${career.color} mb-3">
                                    <i class="fas fa-money-bill-wave me-2"></i>
                                    Salary Range
                                </h6>
                                <p class="h5 text-success mb-0">${career.salary}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 bg-light h-100">
                            <div class="card-body">
                                <h6 class="fw-bold text-${career.color} mb-3">
                                    <i class="fas fa-graduation-cap me-2"></i>
                                    Education Required
                                </h6>
                                <p class="mb-0">${career.education}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 bg-light h-100">
                            <div class="card-body">
                                <h6 class="fw-bold text-${career.color} mb-3">
                                    <i class="fas fa-building me-2"></i>
                                    Work Environment
                                </h6>
                                <p class="mb-0">${career.workEnvironment}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 bg-light h-100">
                            <div class="card-body">
                                <h6 class="fw-bold text-${career.color} mb-3">
                                    <i class="fas fa-chart-line me-2"></i>
                                    Job Outlook
                                </h6>
                                <p class="mb-0">${career.jobOutlook}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h6 class="fw-bold text-${career.color} mb-3">
                        <i class="fas fa-cogs me-2"></i>
                        Key Skills Required
                    </h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${career.skills.map(skill => `
                            <span class="badge bg-${career.color} bg-opacity-10 text-${career.color} p-2">${skill}</span>
                        `).join('')}
                    </div>
                </div>

                <div class="mt-4">
                    <h6 class="fw-bold text-${career.color} mb-3">
                        <i class="fas fa-clipboard-check me-2"></i>
                        Entry Requirements
                    </h6>
                    <p class="text-muted">${career.requirements}</p>
                </div>

                <div class="text-center mt-4 pt-4 border-top">
                    <div class="d-flex flex-column flex-md-row gap-3 justify-content-center mb-4">
                        <a href="pathways.html#${career.pathway}" class="btn btn-${career.color}">
                            <i class="fas fa-route me-2"></i>
                            View ${career.pathway.toUpperCase()} Pathway
                        </a>
                        <a href="assessment.html" class="btn btn-outline-${career.color}">
                            <i class="fas fa-clipboard-list me-2"></i>
                            Take Career Assessment
                        </a>
                        <a href="chat.html" class="btn btn-outline-secondary">
                            <i class="fas fa-comments me-2"></i>
                            Ask AI Guide
                        </a>
                    </div>
                    
                    <!-- Official Government Link in Modal -->
                    <div class="mt-4 p-3 bg-primary bg-opacity-10 rounded-3">
                        <p class="mb-2 text-muted small">
                            <i class="fas fa-info-circle me-2"></i>
                            For official career information:
                        </p>
                        <a href="https://selection.education.go.ke/possible-careers" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Ministry Career Database
                        </a>
                    </div>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('careerModal'));
            modal.show();

            // Track career exploration
            if (currentUser) {
                trackCareerExploration(career.name, career.pathway);
            }
        }

        function filterByPathway(pathway) {
            if (pathway === 'all') {
                filteredCareers = [...allCareers];
            } else {
                filteredCareers = allCareers.filter(career => career.pathway === pathway);
            }
            
            // Clear existing careers
            document.getElementById('careersGrid').innerHTML = '';
            displayedCareers = 0;
            
            updateCareerCount();
            loadMoreCareers();
        }

        function filterCareers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (searchTerm === '') {
                filteredCareers = [...allCareers];
            } else {
                filteredCareers = allCareers.filter(career =>
                    career.name.toLowerCase().includes(searchTerm) ||
                    career.description.toLowerCase().includes(searchTerm) ||
                    career.skills.some(skill => skill.toLowerCase().includes(searchTerm))
                );
            }
            
            // Clear existing careers
            document.getElementById('careersGrid').innerHTML = '';
            displayedCareers = 0;
            
            updateCareerCount();
            loadMoreCareers();
        }

        async function trackCareerExploration(careerName, pathway) {
            try {
                await supabase
                    .from('user_activities')
                    .insert([
                        {
                            user_id: currentUser.id,
                            activity_type: 'career_explored',
                            activity_data: { 
                                career: careerName,
                                pathway: pathway 
                            },
                            timestamp: new Date().toISOString()
                        }
                    ]);
            } catch (error) {
                console.error('Error tracking career exploration:', error);
            }
        }

        function changeLanguage() {
            const select = document.getElementById('languageSelect');
            const currentLanguage = select.value;
            localStorage.setItem('selectedLanguage', currentLanguage);
            
            document.querySelectorAll('[data-en]').forEach(element => {
                if (currentLanguage === 'en') {
                    element.textContent = element.getAttribute('data-en');
                } else {
                    element.textContent = element.getAttribute('data-sw');
                }
            });
        }

        // Show auth section after page load
        document.getElementById('authSection').classList.remove('d-none');

        // Check for URL parameters
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const pathway = urlParams.get('pathway');
            if (pathway && ['stem', 'social', 'arts', 'technical'].includes(pathway)) {
                // Activate the corresponding tab
                document.getElementById(`${pathway}-tab`).click();
            }
        });
    </script>

</body>
</html>